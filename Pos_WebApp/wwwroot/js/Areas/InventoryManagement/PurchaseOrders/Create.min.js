function ResetForm(){$("#create-po-form").trigger("reset");$("#podetails-table tbody").find("tr:gt(0)").remove();$("#deleted-rows-table tbody").html("<tr><\/tr>");setTimeout(function(){$(".select").trigger("change.select2");$(".select").trigger("change.select2")},100)}function getSubItemRow(n){$.ajax({url:"/PurchaseOrders/AddPo_PoDetailsRow?rowNo="+n,type:"GET",success:function(t){$("#podetails-table tbody tr:last").after(t);$(".select").select2();CalculatePoDetails_Total(n)},error:function(){}})}function AddRow(){$("#btn-add-subitems-row").attr("disabled","disabled");var n=parseInt($("#podetails-table tbody tr:last")[0].getAttribute("data-row-no"))+1;getSubItemRow(n);setTimeout(function(){$("#btn-add-subitems-row").removeAttr("disabled")},300)}function RemoveRow(n){var i="table#podetails-table tbody tr.row-no-"+n+" ",t;$("table#podetails-table tbody tr").length>1&&($(i+" td .row-status").val(STATUSES.DELETED),t=$(i).clone(),$(t).removeClass("row-no-"+n),$(t).addClass("del-row-no-"+n),$("#deleted-rows-table tbody tr:last").after(t),$(i).remove())}function CalculatePoDetails_Total(n){var t=0,i=parseFloat($(`#InvPoDetails_${n}__RequestedQuantity`).val()),r=parseFloat($(`#InvPoDetails_${n}__Rate`).val());t=i*r;t=Number(t.toFixed(2));$(`#InvPoDetails_${n}__Amount`).val(t)}function ItemSelect_OnChange(n){var t=$("#InvPoDetails_"+n+"__ItemId option:selected")[0].getAttribute("data-purchaseRate");$("#InvPoDetails_"+n+"__Rate").val(t);CalculatePoDetails_Total(n)}function ConvertDateForDateInput(n){var t,i;return n instanceof Date?(t=n.getMonth()+1,i=n.getDate(),t<10&&(t="0"+t),i<10&&(i="0"+i),n.getFullYear()+"-"+t+"-"+i):null}function ValidateAll(n){NonEmptyRowsCount++;var t=!0;return $(n).find("td:eq(0) select").val()=="-1"?($(n).find("td:eq(0) .invalid-span").css("display","block"),t=!1):$(n).find("td:eq(0) .invalid-span").css("display","none"),$(n).find("td:eq(1) input").val().trim()==""||parseInt($(n).find("td:eq(1) input").val().trim())==0?($(n).find("td:eq(1) .invalid-span").css("display","block"),t=!1):$(n).find("td:eq(1) .invalid-span").css("display","none"),$(n).find("td:eq(2) input").val()==""?($(n).find("td:eq(2) .invalid-span").css("display","block"),t=!1):$(n).find("td:eq(2) .invalid-span").css("display","none"),t==!1&&(FormIsValid=!1),t}var FormIsValid=!0,NonEmptyRowsCount=0;$(document).ready(function(){var t,i,n,r;for($("#PoDate").val()===""&&(t=ConvertDateForDateInput(new Date),$("#PoDate").val(t)),$(".select").select2(),i=$("table#podetails-table tbody tr").length,n=0;n<i;n++)($("#InvPoDetails_"+n+"__Rate").val()==="0"||$("#InvPoDetails_"+n+"__Rate").val()==="")&&(r=$("#InvPoDetails_"+n+"__ItemId option:selected")[0].getAttribute("data-purchaseRate"),$("#InvPoDetails_"+n+"__Rate").val(r)),CalculatePoDetails_Total(n);$("#create-po-form").submit(function(n){var u,i,t,e,f;for(n.preventDefault(),FormIsValid=!0,NonEmptyRowsCount=0,u=$("table#podetails-table tbody tr"),i=0;i<u.length;i++)t=u[i],e=$(t).find("td:eq(0) select").val(),e!=="-1"?ValidateAll(t):($(t).find("td:eq(1) input").val()!==""?ValidateAll(t):$(t).find("td:eq(1) .invalid-span").css("display","none"),$(t).find("td:eq(2) select").val()!==""?ValidateAll(t):$(t).find("td:eq(2) .invalid-span").css("display","none"));if(NonEmptyRowsCount===0&&sweetAlert.error({title:"Invalid!",text:"PO Details Table is empty."}),FormIsValid&&NonEmptyRowsCount!==0){var r="btn-create-po",o="/PurchaseOrders/Create",s="create-po-form";const n=new FormData(this);f=$(`#${r}`).html();setButtonBusy(r);$.ajax({url:o,type:"POST",data:n,cache:!1,contentType:!1,processData:!1,headers:{RequestVerificationToken:$(`form#${s} > input[name="__RequestVerificationToken"]`).val()},success:function(n){console.log(n);n.errorOccured?sweetAlert.error({text:n.errorMessage}):AlertManager.AlertSweetly(n);(n.responseCode===CODES.RESPONSE_CODE_OK||n.responseCode===CODES.RESPONSE_CODE_CREATED)&&ResetForm();window.scrollTo({top:0,left:0,behavior:"smooth"});setButtonFree(r,f)},error:function(n){console.log(n);sweetAlert.error({text:"An Error Occured."});setButtonFree(r,f)}})}})});