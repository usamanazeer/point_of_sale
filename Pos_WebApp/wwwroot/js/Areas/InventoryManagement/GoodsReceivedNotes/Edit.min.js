function Vendor_OnChange(){var n=$("#VendorId").val();$("#PoId").find("option").remove().end().append('<option value=""><\/option>').val("");n!=""?$.ajax({url:"/PurchaseOrders/GetSelectList/?vendorId="+n,type:"GET",success:function(n){var i,t;if(n.responseCode==CODES.RESPONSE_CODE_OK)for(i in n.model)t=n.model[i],$("#PoId").append('<option value="'+t.value+'">'+t.text+"<\/option>");else console.error("error occured while getting POs.");$("#PoId").removeAttr("disabled");$("#btn-load-po").removeAttr("disabled")},error:function(){console.error("error occured while getting POs.")}}):($("#PoId").attr("disabled","disabled"),$("#btn-load-po").attr("disabled","disabled"))}function LoadPO(){if($("#PoId").val()!=""){var n=$("#PoId").val();$.ajax({url:"/PurchaseOrders/GetDetails/"+n,type:"GET",success:function(n){var t,r,i;if(n.responseCode==CODES.RESPONSE_CODE_OK)for(t=n.model,t.invPoDetails.length>0&&($("#btn-load-po").attr("disabled","disabled"),$("#PoId").attr("disabled","disabled")),r=parseInt($("#grndetails-table tbody tr:last")[0].getAttribute("data-row-no"))+1,i=0;i<t.invPoDetails.length;i++){var u=t.invPoDetails[i],e={PoId:t.id,ItemId:u.itemId,ReceivedQuantity:u.requestedQuantity,Rate:u.rate,Po:{Id:t.id,PoNo:t.poNo}},f=!1;i==t.invPoDetails.length-1&&(f=!0);getSubItemRow(r,e,f);r++}},error:function(n){console.error(n)}})}}function getSubItemRow(n,t,i){t?t.Id=n:t={Id:n};$.ajax({url:"/GoodsReceivedNotes/AddGrn_GrnDetailsRow",type:"POST",data:t,headers:{RequestVerificationToken:$('input:hidden[name="__RequestVerificationToken"]').val()},success:function(t){$("#grndetails-table tbody tr:last").after(t);$(".select").select2();CalculateGrnDetails_Total(n);i&&setTimeout(function(){$("#btn-load-po").removeAttr("disabled");$("#PoId").removeAttr("disabled")},300)},error:function(){}})}function AddRow(n){$("#btn-add-subitems-row").attr("disabled","disabled");var t=parseInt($("#grndetails-table tbody tr:last")[0].getAttribute("data-row-no"))+1;getSubItemRow(t,n);setTimeout(function(){$("#btn-add-subitems-row").removeAttr("disabled")},300)}function RemoveRow(n){var i="table#grndetails-table tbody tr.row-no-"+n+" ",t;$("table#grndetails-table tbody tr").length>1&&($(i+" td .row-status").val(STATUSES.DELETED),t=$(i).clone(),$(t).removeClass("row-no-"+n),$(t).addClass("del-row-no-"+n),$("#deleted-rows-table tbody tr:last").after(t),$(i).remove())}function CalculateGrnDetails_Total(n){var t=0,i=parseFloat($(`#InvGrnDetails_${n}__ReceivedQuantity`).val()),r=parseFloat($(`#InvGrnDetails_${n}__Rate`).val());t=i*r;t=Number(t.toFixed(2));$(`#InvGrnDetails_${n}__Amount`).val(t)}function ItemSelect_OnChange(n){var t=$("#InvGrnDetails_"+n+"__ItemId option:selected")[0].getAttribute("data-purchaseRate");$("#InvGrnDetails_"+n+"__Rate").val(t);CalculateGrnDetails_Total(n)}function ConvertDateForDateInput(n){var t,i;if(n instanceof Date)return t=n.getMonth()+1,i=n.getDate(),t<10&&(t="0"+t),i<10&&(i="0"+i),n.getFullYear()+"-"+t+"-"+i}function ValidateAll(n){NonEmptyRowsCount++;var t=!0;return $(n).find("td:eq(1) select").val()=="-1"?($(n).find("td:eq(1) .invalid-span").css("display","block"),t=!1):$(n).find("td:eq(1) .invalid-span").css("display","none"),$(n).find("td:eq(3) input").val()==""||parseInt($(n).find("td:eq(3) input").val().trim())==0?($(n).find("td:eq(3) .invalid-span").css("display","block"),t=!1):$(n).find("td:eq(3) .invalid-span").css("display","none"),$(n).find("td:eq(4) input").val()==""?($(n).find("td:eq(4) .invalid-span").css("display","block"),t=!1):$(n).find("td:eq(4) .invalid-span").css("display","none"),t==!1&&(FormIsValid=!1),t}var FormIsValid=!0,NonEmptyRowsCount=0;$(document).ready(function(){var t,i,n,r;for($("#GrnDate").val()==""&&(t=ConvertDateForDateInput(new Date),$("#GrnDate").val(t)),$(".select").select2(),i=$("table#grndetails-table tbody tr").length,n=0;n<i;n++)($("#InvGrnDetails_"+n+"__Rate").val()=="0"||$("#InvGrnDetails_"+n+"__Rate").val()=="")&&(r=$("#InvGrnDetails_"+n+"__ItemId option:selected")[0].getAttribute("data-purchaseRate"),$("#InvGrnDetails_"+n+"__Rate").val(r)),CalculateGrnDetails_Total(n);$("#edit-grn-form").submit(function(n){var u,i,t,e,f;for(n.preventDefault(),FormIsValid=!0,NonEmptyRowsCount=0,u=$("table#grndetails-table tbody tr"),i=0;i<u.length;i++)t=u[i],e=$(t).find("td:eq(1) select").val(),e!="-1"?ValidateAll(t):($(t).find("td:eq(3) input").val()!=""?ValidateAll(t):$(t).find("td:eq(3) .invalid-span").css("display","none"),$(t).find("td:eq(4) select").val()!=""?ValidateAll(t):$(t).find("td:eq(4) .invalid-span").css("display","none"));if(NonEmptyRowsCount==0&&sweetAlert.error({title:"Invalid!",text:"GRN Details Table is empty."}),FormIsValid&&NonEmptyRowsCount!==0){var r="btn-edit-grn",o="/GoodsReceivedNotes/Edit",s="edit-grn-form";const n=new FormData(this);f=$(`#${r}`).html();setButtonBusy(r);$.ajax({url:o,type:"POST",data:n,cache:!1,contentType:!1,processData:!1,headers:{RequestVerificationToken:$(`form#${s} > input[name="__RequestVerificationToken"]`).val()},success:function(n){console.log(n);n.errorOccured?sweetAlert.error({text:n.errorMessage}):AlertManager.AlertSweetly(n);setButtonFree(r,f)},error:function(n){console.log(n);sweetAlert.error({text:"An Error Occured."});setButtonFree(r,f)}})}})});