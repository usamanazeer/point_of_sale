function ResetForm(){$("#create-purchase-form").trigger("reset");$("#purchases-table tbody").find("tr:gt(0)").remove();$("#deleted-rows-table tbody").html("<tr><\/tr>");$(".select").trigger("change.select2")}function ApplySelect2(){$(".select").select2()}function ValidateAll(n){NonEmptyRowsCount++;var t=!0;return $(n).find("td:eq(0) select").val()===""?($(n).find("td:eq(0) .invalid-span").css("display","block"),t=!1):$(n).find("td:eq(0) .invalid-span").css("display","none"),$(n).find("td:eq(2) input").val()===""||parseFloat($(n).find("td:eq(2) input").val())===0?($(n).find("td:eq(2) .invalid-span").css("display","block"),t=!1):$(n).find("td:eq(2) .invalid-span").css("display","none"),$(n).find("td:eq(5) input").val()===""?($(n).find("td:eq(5) .invalid-span").css("display","block"),t=!1):$(n).find("td:eq(5) .invalid-span").css("display","none"),t===!1&&(FormIsValid=!1),t}function AddRow(){var n=parseInt($("#purchases-table tbody tr:last")[0].getAttribute("data-row-no"))+1;$.ajax({url:"/Purchases/GetPurchaseDetailRow?rowNo="+n,type:"GET",success:function(n){$("#purchases-table tbody tr:last").after(n);ApplySelect2()},error:function(n){console.log("error while adding row: ",n)}})}function RemoveRow(n){var i=`table#purchases-table tbody tr.row-no-${n} `,t;$("table#purchases-table tbody tr").length>1&&($(i+" td .row-status").val(STATUSES.DELETED),t=$(i).clone(),$(t).removeClass("row-no-"+n),$(t).addClass("del-row-no-"+n),$("#deleted-rows-table tbody tr:last").after(t),$(i).remove())}function ItemBarCodeSelect_OnChange(n){if(flag){var t=$("#InvPurchaseDetail_"+n+"__BarCodeId option:selected")[0].getAttribute("data-ItemId");$("#InvPurchaseDetail_"+n+"__ItemId").val(t);flag=!1;$("#InvPurchaseDetail_"+n+"__ItemId").trigger("change.select2");flag=!0}}function ItemSelect_OnChange(n){var r=$("#InvPurchaseDetail_"+n+"__ItemId option:selected")[0].getAttribute("data-PurchaseRate"),u=$("#InvPurchaseDetail_"+n+"__ItemId option:selected")[0].getAttribute("data-SalesRate"),t,i;$(`#InvPurchaseDetail_${n}__PurchaseRate`).val(r);$(`#InvPurchaseDetail_${n}__SalesRate`).val(u);flag&&(t=$(`#InvPurchaseDetail_${n}__ItemId option:selected`)[0].getAttribute("data-ItemBrCode"),t!=null&&(t=t.trim()),flag=!1,t!==""?(i=$("#InvPurchaseDetail_"+n+"__BarCodeId option:contains("+t+")").val(),$(`#InvPurchaseDetail_${n}__BarCodeId`).val(i),$(`#InvPurchaseDetail_${n}__BarCodeId`).trigger("change.select2")):($(`#InvPurchaseDetail_${n}__BarCodeId`).val(""),$(`#InvPurchaseDetail_${n}__BarCodeId`).trigger("change.select2")),flag=!0)}var FormIsValid=!0,NonEmptyRowsCount=0,flag;$(document).ready(function(){ApplySelect2();$("#create-purchase-form").submit(function(n){var u,i,t,e,f;if(n.preventDefault(),FormIsValid=!0,$("#PurchaseDate").val()==="")FormIsValid=!1,sweetAlert.error({title:"Required!",text:"Purchase Date is Required."});else{for(NonEmptyRowsCount=0,u=$("table#purchases-table tbody tr"),i=0;i<u.length;i++)t=u[i],e=$(t).find("td:eq(0) select").val(),e!==""?ValidateAll(t):($(t).find("td:eq(2) input").val()!==""&&parseFloat($(t).find("td:eq(2) input").val())!==0?ValidateAll(t):$(t).find("td:eq(2) .invalid-span").css("display","none"),$(t).find("td:eq(5) input").val()!==""?ValidateAll(t):$(t).find("td:eq(5) .invalid-span").css("display","none"),$(t).find("td:eq(7) select").val()!==""&&ValidateAll(t));if(NonEmptyRowsCount===0&&sweetAlert.error({title:"Invalid!",text:"Purchases Table is empty."}),console.log("FormIsValid",FormIsValid),console.log("NonEmptyRowsCount > 0",NonEmptyRowsCount),console.log(FormIsValid===!0&&NonEmptyRowsCount>0),FormIsValid===!0&&NonEmptyRowsCount>0){var o="/Purchases/Create",s="create-purchase-form",r="btn-create-purchase";const n=new FormData(this);f=$(`#${r}`).html();setButtonBusy(r);$.ajax({url:o,type:"POST",data:n,cache:!1,contentType:!1,processData:!1,headers:{RequestVerificationToken:$(`form#${s} > input[name="__RequestVerificationToken"]`).val()},success:function(n){console.log(n);n.errorOccured?sweetAlert.error({text:n.errorMessage}):AlertManager.AlertSweetly(n);(n.responseCode===CODES.RESPONSE_CODE_OK||n.responseCode===CODES.RESPONSE_CODE_CREATED)&&ResetForm();window.scrollTo({top:0,left:0,behavior:"smooth"});setButtonFree(r,f)},error:function(n){console.log(n);sweetAlert.error({text:"An Error Occured."});setButtonFree(r,f)}})}}})});flag=!0;